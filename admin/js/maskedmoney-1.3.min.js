(function(j){j.fn.maskMoney=function(b){b=j.extend({symbol:"US$",showSymbol:false,symbolStay:false,thousands:",",decimal:".",precision:2,defaultZero:true,allowZero:false,allowNegative:false},b);return this.each(function(){function k(a){a=a||window.event;var d=a.charCode||a.keyCode||a.which;if(d==undefined)return false;if(c.attr("readonly")&&d!=13&&d!=9)return false;if(d<48||d>57){if(d==45){c.val(q(c));return false}if(d==43){c.val(c.val().replace("-",""));return false}else{d==13||d==9||d==37||d==39||
h(a);return true}}else{if(c.val().length!=c.attr("maxlength")){h(a);a=String.fromCharCode(d);d=c.get(0);var e=c.getInputSelection(d),f=e.start;e=e.end;d.value=d.value.substring(0,f)+a+d.value.substring(e,d.value.length);n(d,f+1)}return false}}function g(a){j.browser.msie&&k(a);if(c.val()==""||c.val()==o(p())||c.val()==b.symbol)if(b.allowZero)b.symbolStay?c.val(o(p())):c.val(p());else c.val("");else if(b.symbolStay)b.symbolStay&&c.val()==b.symbol&&c.val(o(p()));else c.val(c.val().replace(b.symbol,
""))}function h(a){if(a.preventDefault)a.preventDefault();else a.returnValue=false}function n(a,d){var e=c.val().length;c.val(m(a.value));var f=c.val().length;d-=e-f;c.setCursorPosition(d)}function m(a){a=a.replace(b.symbol,"");var d=a.length,e="",f="",i="";if(d!=0&&a.charAt(0)=="-"){a=a.replace("-","");if(b.allowNegative)i="-"}if(d==0)if(!b.defaultZero)return f;for(var l=0;l<d;l++)if(a.charAt(l)!="0"&&a.charAt(l)!=b.decimal)break;for(;l<d;l++)if("0123456789".indexOf(a.charAt(l))!=-1)e+=a.charAt(l);
f=parseFloat(e);f=isNaN(f)?0:f/Math.pow(10,b.precision);f=f.toFixed(b.precision);l=b.precision==0?0:1;d=(f=f.split("."))[l].substr(0,b.precision);for(a=(f=f[0]).length;(a-=3)>=1;)f=f.substr(0,a)+b.thousands+f.substr(a);return b.precision>0?o(i+f+b.decimal+d+Array(b.precision+1-d.length).join(0)):o(i+f)}function p(){return(parseFloat("0")/Math.pow(10,b.precision)).toFixed(b.precision).replace(RegExp("\\.","g"),b.decimal)}function o(a){if(b.showSymbol)if(a.substr(0,b.symbol.length)!=b.symbol)return b.symbol+
a;return a}function q(a){if(b.allowNegative){a.val();return a.val()!=""&&a.val().charAt(0)=="-"?a.val().replace("-",""):"-"+a.val()}else return a.val()}var c=j(this);c.bind("keypress.maskMoney",k);c.bind("keydown.maskMoney",function(a){a=a||window.event;var d=a.charCode||a.keyCode||a.which;if(d==undefined)return false;if(c.attr("readonly")&&d!=13&&d!=9)return false;var e=c.get(0),f=c.getInputSelection(e),i=f.start;f=f.end;if(d==8){h(a);if(i==f){e.value=e.value.substring(0,i-1)+e.value.substring(f,
e.value.length);i-=1}else e.value=e.value.substring(0,i)+e.value.substring(f,e.value.length);n(e,i);return false}else if(d==9)return true;else if(d==46||d==63272){h(a);e.value=e.selectionStart==e.selectionEnd?e.value.substring(0,i)+e.value.substring(f+1,e.value.length):e.value.substring(0,i)+e.value.substring(f,e.value.length);n(e,i);return false}else return true});c.bind("blur.maskMoney",g);c.bind("focus.maskMoney",function(){var a=p();if(c.val()==a)c.val("");else c.val()==""&&b.defaultZero?c.val(o(a)):
c.val(o(c.val()));if(this.createTextRange){a=this.createTextRange();a.collapse(false);a.select()}});c.bind("mask",function(){var a=c.val();c.val(m(a))});c.one("unmaskMoney",function(){c.unbind(".maskMoney");if(j.browser.msie)this.onpaste=null;else j.browser.mozilla&&this.removeEventListener("input",g,false)})})};j.fn.unmaskMoney=function(){return this.trigger("unmaskMoney")};j.fn.mask=function(){return this.trigger("mask")};j.fn.setCursorPosition=function(b){this.each(function(k,g){if(g.setSelectionRange){g.focus();
g.setSelectionRange(b,b)}else if(g.createTextRange){var h=g.createTextRange();h.collapse(true);h.moveEnd("character",b);h.moveStart("character",b);h.select()}});return this};j.fn.getInputSelection=function(b){var k=0,g=0,h,n,m;if(typeof b.selectionStart=="number"&&typeof b.selectionEnd=="number"){k=b.selectionStart;g=b.selectionEnd}else if((n=document.selection.createRange())&&n.parentElement()==b){m=b.value.length;h=b.value.replace(/\r\n/g,"\n");g=b.createTextRange();g.moveToBookmark(n.getBookmark());
b=b.createTextRange();b.collapse(false);if(g.compareEndPoints("StartToEnd",b)>-1)k=g=m;else{k=-g.moveStart("character",-m);k+=h.slice(0,k).split("\n").length-1;if(g.compareEndPoints("EndToEnd",b)>-1)g=m;else{g=-g.moveEnd("character",-m);g+=h.slice(0,g).split("\n").length-1}}}return{start:k,end:g}}})(jQuery);